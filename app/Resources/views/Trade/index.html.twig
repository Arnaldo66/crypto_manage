{% extends "::base.html.twig" %}

{% block title_wrapper %}
    <div class="pull-right">
        <a href="{{ path('trade_new') }}" class="btn btn-primary"> {{ 'new'|trans }}</a>
    </div>
  <h2>Mes portefeuilles</h2>
{% endblock title_wrapper %}


{% block body %}
  <div class="row">
      <div class="col-lg-12">
          <div class="panel panel-default">
              <div class="panel-heading">
                  Liste de mes portefeuilles de trading <i>(cliquez pour y accéder)</i>
                  <div class="pull-righ">
                  </div>
              </div>
              <!-- /.panel-heading -->
              <div class="panel-body">
                  <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-wallets">
                      <thead>
                          <tr>
                            <th>Nom</th>
                            <th>Investissement initial</th>
                            <th>Montant actuel</th>
                            <th>Date création</th>
                            <th>Gain</th>
                            <th>Gain en %</th>
                            <th>Supprimer</th>
                          </tr>
                      </thead>
                      <tbody>


                          <table class="table table-striped table-bordered table-hover dataTables-example dataTable" id="DataTables_Table_0" aria-describedby="DataTables_Table_0_info" role="grid"><thead><tr role="row"><th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" style="width: 161.033px;" aria-label="Rendering engine: activate to sort column ascending">Rendering engine</th><th class="sorting_asc" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" style="width: 201.783px;" aria-label="Browser: activate to sort column descending" aria-sort="ascending">Browser</th><th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" style="width: 180.517px;" aria-label="Platform(s): activate to sort column ascending">Platform(s)</th><th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" style="width: 136.3px;" aria-label="Engine version: activate to sort column ascending">Engine version</th><th class="sorting" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1" style="width: 94.3667px;" aria-label="CSS grade: activate to sort column ascending">CSS grade</th></tr></thead><tbody><tr class="gradeU odd" role="row"><td class="">Other browsers</td><td class="sorting_1">All others</td><td>-</td><td class="center">-</td><td class="center">U</td></tr><tr class="gradeA even" role="row"><td class="">Trident</td><td class="sorting_1">AOL browser (AOL desktop)</td><td>Win XP</td><td class="center">6</td><td class="center">A</td></tr><tr class="gradeA odd" role="row"><td class="">Gecko</td><td class="sorting_1">Camino 1.0</td><td>OSX.2+</td><td class="center">1.8</td><td class="center">A</td></tr><tr class="gradeA even" role="row"><td class="">Gecko</td><td class="sorting_1">Camino 1.5</td><td>OSX.3+</td><td class="center">1.8</td><td class="center">A</td></tr><tr class="gradeX odd" role="row"><td class="">Misc</td><td class="sorting_1">Dillo 0.8</td><td>Embedded devices</td><td class="center">-</td><td class="center">X</td></tr><tr class="gradeA even" role="row"><td class="">Gecko</td><td class="sorting_1">Epiphany 2.20</td><td>Gnome</td><td class="center">1.8</td><td class="center">A</td></tr><tr class="gradeA odd" role="row"><td class="">Gecko</td><td class="sorting_1">Firefox 1.0</td><td>Win 98+ / OSX.2+</td><td class="center">1.7</td><td class="center">A</td></tr><tr class="gradeA even" role="row"><td class="">Gecko</td><td class="sorting_1">Firefox 1.5</td><td>Win 98+ / OSX.2+</td><td class="center">1.8</td><td class="center">A</td></tr><tr class="gradeA odd" role="row"><td class="">Gecko</td><td class="sorting_1">Firefox 2.0</td><td>Win 98+ / OSX.2+</td><td class="center">1.8</td><td class="center">A</td></tr><tr class="gradeA even" role="row"><td class="">Gecko</td><td class="sorting_1">Firefox 3.0</td><td>Win 2k+ / OSX.3+</td><td class="center">1.9</td><td class="center">A</td></tr><tr class="gradeC odd" role="row"><td class="">Misc</td><td class="sorting_1">IE Mobile</td><td>Windows Mobile 6</td><td class="center">-</td><td class="center">C</td></tr><tr class="gradeX even" role="row"><td class="">Trident</td><td class="sorting_1">InternetExplorer 4.0</td><td>Win 95+</td><td class="center">4</td><td class="center">X</td></tr><tr class="gradeC odd" role="row"><td class="">Trident</td><td class="sorting_1">InternetExplorer 5.0</td><td>Win 95+</td><td class="center">5</td><td class="center">C</td></tr><tr class="gradeA even" role="row"><td class="">Trident</td><td class="sorting_1">InternetExplorer 5.5</td><td>Win 95+</td><td class="center">5.5</td><td class="center">A</td></tr><tr class="gradeA odd" role="row"><td class="">Trident</td><td class="sorting_1">InternetExplorer 6</td><td>Win 98+</td><td class="center">6</td><td class="center">A</td></tr><tr class="gradeX even" role="row"><td class="">Tasman</td><td class="sorting_1">Internet Explorer 4.5</td><td>Mac OS 8-9</td><td class="center">-</td><td class="center">X</td></tr><tr class="gradeC odd" role="row"><td class="">Tasman</td><td class="sorting_1">Internet Explorer 5.1</td><td>Mac OS 7.6-9</td><td class="center">1</td><td class="center">C</td></tr><tr class="gradeC even" role="row"><td class="">Tasman</td><td class="sorting_1">Internet Explorer 5.2</td><td>Mac OS 8-X</td><td class="center">1</td><td class="center">C</td></tr><tr class="gradeA odd" role="row"><td class="">Trident</td><td class="sorting_1">Internet Explorer 7</td><td>Win XP SP2+</td><td class="center">7</td><td class="center">A</td></tr><tr class="gradeA even" role="row"><td class="">Webkit</td><td class="sorting_1">iPod Touch / iPhone</td><td>iPod</td><td class="center">420.1</td><td class="center">A</td></tr><tr class="gradeC odd" role="row"><td class="">KHTML</td><td class="sorting_1">Konqureror 3.1</td><td>KDE 3.1</td><td class="center">3.1</td><td class="center">C</td></tr><tr class="gradeA even" role="row"><td class="">KHTML</td><td class="sorting_1">Konqureror 3.3</td><td>KDE 3.3</td><td class="center">3.3</td><td class="center">A</td></tr><tr class="gradeA odd" role="row"><td class="">KHTML</td><td class="sorting_1">Konqureror 3.5</td><td>KDE 3.5</td><td class="center">3.5</td><td class="center">A</td></tr><tr class="gradeX even" role="row"><td class="">Misc</td><td class="sorting_1">Links</td><td>Text only</td><td class="center">-</td><td class="center">X</td></tr><tr class="gradeX odd" role="row"><td class="">Misc</td><td class="sorting_1">Lynx</td><td>Text only</td><td class="center">-</td><td class="center">X</td></tr></tbody><tfoot><tr><th rowspan="1" colspan="1">Rendering engine</th><th rowspan="1" colspan="1">Browser</th><th rowspan="1" colspan="1">Platform(s)</th><th rowspan="1" colspan="1">Engine version</th><th rowspan="1" colspan="1">CSS grade</th></tr></tfoot></table>



                          {% for wallet in wallets %}
                            {% set totalWallet = 0 %}
                            {% for currencyWallet in wallet.currencyWallets %}
                              {% set totalWallet = totalWallet + (currencyWallet.amount * currencyWallet.currency.priceEur) %}
                            {% endfor %}
                            <tr class="odd gradeX">
                              <td><a href="{{ path('trade_show',{id:wallet.id}) }}">{{ wallet.name }}</a></td>
                              <td>{{ wallet.initialAmount }}</td>
                              <td>{{ (wallet.euroWallet.amount + totalWallet)|price }}</td>
                              <td><span class='hide'>{{ wallet.createdAt|date("Y/m/d h:m:s") }}</span>{{ wallet.createdAt|date("d/m/Y h:m:s")  }}</td>
                              {% set balance = (wallet.euroWallet.amount + totalWallet - wallet.initialAmount)|price %}
                              {% if balance > 0 %}
                                {% set div_class_default = "text-navy" %}
                                {% set level_default = "fa-level-up" %}
                              {% elseif balance < 0 %}
                                {% set div_class_default = "text-danger" %}
                                {% set level_default = "fa-level-down" %}
                              {% else %}
                                {% set div_class_default = "text-success" %}
                                {% set level_default = "" %}
                              {% endif %}
                              <td class="{{ div_class_default }}"><i class="fa {{ level_default }}"></i> {{ balance }}€</td>
                              <td class="{{ div_class_default }}">
                                <i class="fa {{ level_default }}"></i>
                                {% set pourcentage = 0 %}
                                {% if balance != 0 %}
                                  {% set result = wallet.euroWallet.amount + totalWallet %}
                                  {% set pourcentage =  ((result - wallet.initialAmount) / (wallet.initialAmount) * 100)|price %}
                                {% endif %}
                                {{ pourcentage }} %
                              </td>
                              <td><p class="fa fa-times-circle" style="cursor:pointer;" data-toggle="modal" data-target="#removeWallet" data-id="{{ wallet.id }}"></p></td>
                            </tr>
                          {% endfor %}
                      </tbody>
                  </table>
              </div>
              <!-- /.panel-body -->
          </div>
          <!-- /.panel -->
      </div>
      <!-- /.col-lg-12 -->
  </div>

  <div class="modal fade" id="removeWallet" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Suppression de wallet</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <form action="" method="POST">
          <div class="modal-body">
            Etes-vous sûr de vouloir supprimer votre portefeuille ?<br/>
            La suppression est définitive
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
            <button type="submit" class="btn btn-primary">Confirmer</button>
          </div>
        </form>
      </div>
    </div>
  </div>


{% endblock %}

{% block local_javascripts %}
  <script>
    $(document).ready(function() {
        $('#removeWallet').on('show.bs.modal', function (event) {
          var button = $(event.relatedTarget);
          var id = button.data('id');
          $(this).find('form').attr('action', Routing.generate('trade_delete', { id: id }));
        })



        $('#dataTables-wallets').DataTable({
            responsive: true,
            "language":{
              "url": "https://cdn.datatables.net/plug-ins/1.10.16/i18n/French.json"
            }
        });
    });
  </script>
{% endblock %}
